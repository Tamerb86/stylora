# âœ… Railway Deployment Checklist

## ðŸŽ¯ Pre-Deployment Checklist

### 1. Railway Account Setup
- [ ] Create Railway account at https://railway.app
- [ ] Verify email address
- [ ] Add payment method (required after free trial)
- [ ] Install Railway CLI (optional): `npm install -g @railway/cli`

### 2. GitHub Repository
- [ ] Code pushed to GitHub repository
- [ ] Repository is accessible (public or Railway has access)
- [ ] All sensitive files in `.gitignore`
- [ ] Latest changes committed and pushed

### 3. Local Build Test
- [ ] âœ… Build works locally: `pnpm build`
- [ ] âœ… No critical errors in build output
- [ ] âœ… All dependencies in `package.json`
- [ ] âœ… Start command works: `pnpm start`

---

## ðŸš€ Railway Deployment Steps

### Step 1: Create New Project
- [ ] Go to Railway dashboard
- [ ] Click **"New Project"**
- [ ] Select **"Deploy from GitHub repo"**
- [ ] Choose `barbertime-website` repository
- [ ] Railway starts initial deployment

### Step 2: Add MySQL Database
- [ ] In project, click **"+ New"**
- [ ] Select **"Database"** â†’ **"Add MySQL"**
- [ ] Wait for database to provision
- [ ] Verify `DATABASE_URL` appears in Variables tab
- [ ] Copy `DATABASE_URL` for reference

### Step 3: Configure Environment Variables
- [ ] Go to service â†’ **"Variables"** tab
- [ ] Add required variables (see list below)
- [ ] Verify all Stylora variables are present
- [ ] Add optional integration variables (Stripe, Email, etc.)
- [ ] Click **"Deploy"** to apply changes

#### Required Variables:
```
âœ… Auto-injected by Stylora:
- BUILT_IN_FORGE_API_KEY
- BUILT_IN_FORGE_API_URL
- JWT_SECRET
- OAUTH_SERVER_URL
- OWNER_OPEN_ID
- SUPABASE_URL
- SUPABASE_ANON_KEY
- SUPABASE_SERVICE_KEY
- VITE_APP_ID
- VITE_APP_TITLE
- VITE_APP_LOGO

ðŸ”§ Must add manually:
- NODE_ENV=production
- PORT=3000
- DATABASE_URL (auto-generated by MySQL service)
```

#### Optional Variables (if using):
```
Stripe:
- STRIPE_SECRET_KEY
- STRIPE_WEBHOOK_SECRET
- VITE_STRIPE_PUBLISHABLE_KEY
- STRIPE_CONNECT_CLIENT_ID

Email (SMTP):
- SMTP_HOST
- SMTP_PORT
- SMTP_USER
- SMTP_PASS
- SMTP_FROM_EMAIL

Email (AWS SES):
- AWS_ACCESS_KEY_ID
- AWS_SECRET_ACCESS_KEY
- AWS_REGION
- AWS_SES_FROM_EMAIL

Vipps:
- VIPPS_CLIENT_ID
- VIPPS_CLIENT_SECRET
- VIPPS_SUBSCRIPTION_KEY
- VIPPS_MERCHANT_SERIAL_NUMBER
- VIPPS_API_URL
```

### Step 4: Run Database Migrations
- [ ] Wait for deployment to complete
- [ ] Open Railway CLI or use dashboard
- [ ] Run: `railway run pnpm db:push`
- [ ] Verify migrations completed successfully
- [ ] Check database tables created

### Step 5: Configure Custom Domain (Optional)
- [ ] Go to service â†’ **"Settings"**
- [ ] Click **"Domains"** section
- [ ] Click **"Generate Domain"** for free Railway domain
- [ ] OR click **"Custom Domain"** to add your own
- [ ] Update DNS records if using custom domain
- [ ] Wait for DNS propagation (5-30 minutes)

### Step 6: Setup Stripe Webhooks (If Using Stripe)
- [ ] Go to https://dashboard.stripe.com/webhooks
- [ ] Click **"Add endpoint"**
- [ ] Enter URL: `https://your-railway-domain/api/stripe/webhook`
- [ ] Select events:
  - `payment_intent.succeeded`
  - `checkout.session.completed`
  - `customer.subscription.created`
  - `customer.subscription.updated`
  - `customer.subscription.deleted`
- [ ] Copy webhook signing secret
- [ ] Add to Railway: `STRIPE_WEBHOOK_SECRET=whsec_...`
- [ ] Redeploy application

---

## âœ… Post-Deployment Verification

### 1. Application Health
- [ ] Visit Railway-provided URL
- [ ] Homepage loads correctly
- [ ] No console errors in browser
- [ ] Check Railway logs for errors

### 2. Database Connection
- [ ] Application connects to database
- [ ] No database connection errors in logs
- [ ] Tables exist in database
- [ ] Can view database in Railway dashboard

### 3. Authentication
- [ ] Admin login page loads: `/saas-admin/login`
- [ ] Can log in with test account
- [ ] Supabase authentication works
- [ ] JWT tokens are generated

### 4. Core Features
- [ ] Dashboard loads after login
- [ ] Can view customers list
- [ ] Can view appointments
- [ ] Can view services
- [ ] Public booking page works: `/book?tenantId=xxx`

### 5. Integrations (If Configured)
- [ ] Stripe checkout works (test mode)
- [ ] Emails send successfully
- [ ] Vipps payment works (test mode)
- [ ] Webhooks receive events

### 6. Performance
- [ ] Page load time < 3 seconds
- [ ] No memory leaks in logs
- [ ] CPU usage normal
- [ ] Database queries optimized

---

## ðŸ› Troubleshooting Guide

### Build Fails
**Symptoms**: Deployment fails during build
**Solutions**:
- [ ] Check build logs in Railway dashboard
- [ ] Verify `pnpm build` works locally
- [ ] Check all dependencies in `package.json`
- [ ] Verify Node.js version (22.x)
- [ ] Check for TypeScript errors (13 warnings are OK)

### Application Won't Start
**Symptoms**: Build succeeds but app crashes
**Solutions**:
- [ ] Check application logs
- [ ] Verify `PORT=3000` is set
- [ ] Check `DATABASE_URL` is correct
- [ ] Verify all required env vars are set
- [ ] Check `pnpm start` works locally

### Database Connection Failed
**Symptoms**: "Database connection error" in logs
**Solutions**:
- [ ] Verify MySQL service is running
- [ ] Check `DATABASE_URL` format is correct
- [ ] Ensure database migrations ran
- [ ] Check database credentials
- [ ] Verify network connectivity

### 502 Bad Gateway
**Symptoms**: Website shows 502 error
**Solutions**:
- [ ] Check application is running in Railway
- [ ] Verify port is set to 3000
- [ ] Check for application crashes in logs
- [ ] Restart service in Railway
- [ ] Check health check endpoint

### Stripe Webhooks Not Working
**Symptoms**: Payments succeed but not recorded
**Solutions**:
- [ ] Verify webhook URL is correct
- [ ] Check `STRIPE_WEBHOOK_SECRET` matches
- [ ] Test webhook in Stripe dashboard
- [ ] Check application logs for webhook errors
- [ ] Verify webhook events are selected

### Emails Not Sending
**Symptoms**: No emails received
**Solutions**:
- [ ] Check SMTP credentials
- [ ] Verify email provider allows SMTP
- [ ] For Gmail: use App Password, not regular password
- [ ] For AWS SES: verify email/domain
- [ ] Check application logs for email errors

---

## ðŸ“Š Monitoring & Maintenance

### Daily Checks
- [ ] Check Railway dashboard for errors
- [ ] Monitor application logs
- [ ] Check database size and usage
- [ ] Verify backups are running

### Weekly Checks
- [ ] Review error logs
- [ ] Check performance metrics
- [ ] Monitor database growth
- [ ] Review user feedback

### Monthly Checks
- [ ] Update dependencies: `pnpm update`
- [ ] Review and rotate secrets
- [ ] Check Railway billing
- [ ] Backup database manually
- [ ] Review security logs

---

## ðŸ’° Cost Estimation

### Railway Costs
- **Hobby Plan**: $5/month (500 execution hours)
- **Pro Plan**: $20/month (unlimited)
- **MySQL Database**: $5-10/month (based on usage)
- **Bandwidth**: Included in plan

### External Services
- **Supabase**: Free tier or $25/month (Pro)
- **Stripe**: 2.9% + $0.30 per transaction
- **AWS SES**: $0.10 per 1,000 emails
- **Vipps**: Transaction fees apply

**Total Estimated Cost**: $15-50/month

---

## ðŸ”’ Security Checklist

### Before Going Live
- [ ] Change all test API keys to production keys
- [ ] Use strong JWT_SECRET (32+ characters)
- [ ] Enable 2FA on Railway account
- [ ] Enable 2FA on GitHub account
- [ ] Review all environment variables
- [ ] Remove any test/debug code
- [ ] Enable HTTPS (automatic on Railway)
- [ ] Configure CORS properly
- [ ] Set up rate limiting
- [ ] Enable database backups

### After Going Live
- [ ] Monitor for suspicious activity
- [ ] Set up error tracking (Sentry)
- [ ] Configure uptime monitoring
- [ ] Set up alerts for errors
- [ ] Regular security audits
- [ ] Keep dependencies updated

---

## ðŸ“ž Support Resources

### Railway
- **Docs**: https://docs.railway.app
- **Discord**: https://discord.gg/railway
- **Status**: https://status.railway.app
- **Support**: support@railway.app

### Integrations
- **Stripe**: https://support.stripe.com
- **Supabase**: https://supabase.com/support
- **AWS**: https://aws.amazon.com/support
- **Vipps**: https://developer.vippsmobilepay.com

---

## âœ… Final Checklist

Before marking deployment as complete:

- [ ] âœ… Application deployed to Railway
- [ ] âœ… Database connected and migrations run
- [ ] âœ… All environment variables configured
- [ ] âœ… Custom domain configured (if applicable)
- [ ] âœ… Stripe webhooks configured (if using)
- [ ] âœ… Email service configured (if using)
- [ ] âœ… All core features tested
- [ ] âœ… No critical errors in logs
- [ ] âœ… Performance is acceptable
- [ ] âœ… Security measures in place
- [ ] âœ… Monitoring configured
- [ ] âœ… Backups enabled
- [ ] âœ… Team has access
- [ ] âœ… Documentation updated
- [ ] âœ… Users notified (if applicable)

---

**Deployment Status**: â³ Ready for Deployment  
**Last Updated**: December 27, 2024  
**Version**: 4ec37722

ðŸŽ‰ **You're ready to deploy to Railway!**
