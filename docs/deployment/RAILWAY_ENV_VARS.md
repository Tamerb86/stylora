# Railway Environment Variables Guide

## üìã Required Environment Variables

### ‚úÖ Already Configured in Stylora (Auto-injected)
These variables are automatically provided by Stylora platform:

```
BUILT_IN_FORGE_API_KEY
BUILT_IN_FORGE_API_URL
JWT_SECRET
OAUTH_SERVER_URL
OWNER_NAME
OWNER_OPEN_ID
SUPABASE_ANON_KEY
SUPABASE_SERVICE_KEY
SUPABASE_URL
VITE_ANALYTICS_ENDPOINT
VITE_ANALYTICS_WEBSITE_ID
VITE_APP_ID
VITE_APP_LOGO
VITE_APP_TITLE
VITE_FRONTEND_FORGE_API_KEY
VITE_FRONTEND_FORGE_API_URL
VITE_OAUTH_PORTAL_URL
```

### üîß Must Add in Railway Dashboard

#### 1. Database (Auto-generated by Railway)
```bash
DATABASE_URL=mysql://user:password@host:port/database
# This is automatically created when you add MySQL database service
```

#### 2. Application Settings
```bash
NODE_ENV=production
PORT=3000
```

---

## üîå Optional Integrations

### Stripe Payment (Recommended)

```bash
# Get from https://dashboard.stripe.com/apikeys
STRIPE_SECRET_KEY=sk_live_...
STRIPE_WEBHOOK_SECRET=whsec_...
VITE_STRIPE_PUBLISHABLE_KEY=pk_live_...
STRIPE_CONNECT_CLIENT_ID=ca_...
```

**Setup Steps:**
1. Create Stripe account at https://stripe.com
2. Get API keys from Dashboard ‚Üí Developers ‚Üí API keys
3. Create webhook endpoint: `https://your-app.railway.app/api/stripe/webhook`
4. Select events: `payment_intent.succeeded`, `checkout.session.completed`
5. Copy webhook secret

---

### Email Notifications (Choose ONE)

#### Option A: SMTP (Gmail, Outlook, etc.)
```bash
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password
SMTP_FROM_EMAIL=noreply@stylora.app
```

**Gmail Setup:**
1. Enable 2FA on your Google account
2. Generate App Password: https://myaccount.google.com/apppasswords
3. Use the generated password in `SMTP_PASS`

#### Option B: AWS SES (Production Recommended)
```bash
AWS_ACCESS_KEY_ID=AKIA...
AWS_SECRET_ACCESS_KEY=...
AWS_REGION=eu-north-1
AWS_SES_FROM_EMAIL=noreply@stylora.app
```

**AWS SES Setup:**
1. Create AWS account
2. Go to SES console
3. Verify your domain/email
4. Create IAM user with SES permissions
5. Generate access keys

---

### Vipps Payment (Norwegian Market)

```bash
VIPPS_CLIENT_ID=your-client-id
VIPPS_CLIENT_SECRET=your-client-secret
VIPPS_SUBSCRIPTION_KEY=your-subscription-key
VIPPS_MERCHANT_SERIAL_NUMBER=123456
VIPPS_API_URL=https://api.vipps.no
```

**Vipps Setup:**
1. Register at https://portal.vipps.no
2. Complete merchant verification
3. Get API credentials from portal
4. For testing: use `https://apitest.vipps.no`
5. For production: use `https://api.vipps.no`

---

## üöÄ How to Add Variables in Railway

### Method 1: Railway Dashboard (Recommended)
1. Go to your Railway project
2. Select your service
3. Click **"Variables"** tab
4. Click **"+ New Variable"**
5. Add variable name and value
6. Click **"Add"**
7. Railway will automatically redeploy

### Method 2: Railway CLI
```bash
# Install Railway CLI
npm install -g @railway/cli

# Login
railway login

# Link to your project
railway link

# Add variable
railway variables set STRIPE_SECRET_KEY=sk_live_...

# Add multiple variables from file
railway variables set --from-file .env
```

---

## ‚úÖ Verification Checklist

### Before Deployment:
- [ ] Railway project created
- [ ] MySQL/PostgreSQL database added
- [ ] `DATABASE_URL` automatically set
- [ ] `NODE_ENV=production` set
- [ ] `PORT=3000` set
- [ ] All Stylora variables confirmed (auto-injected)

### Optional Integrations:
- [ ] Stripe keys added (if using payments)
- [ ] Stripe webhook configured
- [ ] Email provider configured (SMTP or AWS SES)
- [ ] Vipps credentials added (if targeting Norway)

### After Deployment:
- [ ] Application starts successfully
- [ ] Database connection works
- [ ] Authentication works (Supabase)
- [ ] Payments work (if configured)
- [ ] Emails send (if configured)

---

## üîí Security Best Practices

1. **Never commit secrets to git**
   - `.env` is in `.gitignore`
   - Use Railway Variables for all secrets

2. **Use strong secrets**
   - `JWT_SECRET`: minimum 32 characters
   - Generate with: `openssl rand -base64 32`

3. **Separate test and production**
   - Use Stripe test keys in staging
   - Use Stripe live keys in production
   - Use Vipps test API in staging

4. **Rotate secrets regularly**
   - Change JWT_SECRET every 90 days
   - Rotate API keys if compromised

5. **Limit access**
   - Only give Railway access to team members who need it
   - Use Railway's team permissions

---

## üêõ Troubleshooting

### "Database connection failed"
- Check `DATABASE_URL` is set correctly
- Verify MySQL service is running in Railway
- Check database credentials

### "Stripe webhook failed"
- Verify webhook URL is correct
- Check `STRIPE_WEBHOOK_SECRET` matches Stripe dashboard
- Ensure webhook events are selected

### "Email not sending"
- For SMTP: check credentials and port
- For Gmail: ensure App Password is used (not regular password)
- For AWS SES: verify email/domain in SES console

### "Vipps payment failed"
- Check API URL (test vs production)
- Verify merchant is activated
- Check subscription key is valid

---

## üìû Support Resources

- **Railway Docs**: https://docs.railway.app
- **Stripe Docs**: https://stripe.com/docs
- **AWS SES Docs**: https://docs.aws.amazon.com/ses
- **Vipps Docs**: https://developer.vippsmobilepay.com
- **Supabase Docs**: https://supabase.com/docs

---

**Last Updated**: December 27, 2024  
**Version**: 1.0
